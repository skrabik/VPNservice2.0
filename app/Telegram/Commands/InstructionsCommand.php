<?php

namespace App\Telegram\Commands;

use Telegram\Bot\Laravel\Facades\Telegram;

class InstructionsCommand extends BaseCommand
{
    public function handle(): void
    {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ callback_data
        if (isset($this->params['instruction_type'])) {
            $this->sendSpecificInstruction($this->params['instruction_type']);

            return;
        }

        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è
        $messageText = $this->update->getMessage()->getText();

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ–∫—Å—Ç—É –∫–Ω–æ–ø–∫–∏
        $instructionType = match ($messageText) {
            'üì± Outline (Shadowsocks)' => 'outline',
            'üîí OpenVPN' => 'openvpn',
            '‚ö° Xray (V2Ray)' => 'xray',
            '‚¨ÖÔ∏è –ù–∞–∑–∞–¥' => null,
            default => null
        };

        // –ï—Å–ª–∏ —ç—Ç–æ –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –∏–ª–∏ –∫–æ–º–∞–Ω–¥–∞ /instructions - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        if ($instructionType === null) {
            $this->sendMainInstructions();

            return;
        }

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
        $this->sendSpecificInstruction($instructionType);
    }

    private function sendMainInstructions(): void
    {
        $message = "üîß <b>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –∫ VPN</b>\n\n".
            '–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π:';

        $keyboard = [
            [
                ['text' => 'üì± Outline (Shadowsocks)', 'callback_data' => '/instructions?instruction_type=outline'],
                ['text' => 'üîí OpenVPN', 'callback_data' => '/instructions?instruction_type=openvpn'],
            ],
            [
                ['text' => '‚ö° Xray (V2Ray)', 'callback_data' => '/instructions?instruction_type=xray'],
            ],
            [
                ['text' => '‚¨ÖÔ∏è –ù–∞–∑–∞–¥', 'callback_data' => '/help'],
            ],
        ];

        Telegram::sendMessage([
            'chat_id' => $this->customer->telegram_id,
            'text' => $message,
            'parse_mode' => 'HTML',
            'reply_markup' => json_encode([
                'inline_keyboard' => $keyboard,
            ]),
        ]);
    }

    private function sendSpecificInstruction(string $type): void
    {
        $instruction = match ($type) {
            'outline' => $this->getOutlineInstructions(),
            'openvpn' => $this->getOpenVPNInstructions(),
            'xray' => $this->getXrayInstructions(),
            default => $this->getMainInstructions()
        };

        $keyboard = [
            ['‚¨ÖÔ∏è –ù–∞–∑–∞–¥'],
        ];

        Telegram::sendMessage([
            'chat_id' => $this->customer->telegram_id,
            'text' => $instruction,
            'parse_mode' => 'HTML',
            'disable_web_page_preview' => true,
            'reply_markup' => json_encode([
                'keyboard' => $keyboard,
                'resize_keyboard' => true,
                'one_time_keyboard' => false,
            ]),
        ]);
    }

    private function getOutlineInstructions(): string
    {
        return "üì± <b>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –∫ Outline (Shadowsocks)</b>\n\n".
            "üîπ <b>–®–∞–≥ 1: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</b>\n".
            "‚Ä¢ Android: –°–∫–∞—á–∞–π—Ç–µ Outline Client –∏–∑ Google Play\n".
            "‚Ä¢ iOS: –°–∫–∞—á–∞–π—Ç–µ Outline Client –∏–∑ App Store\n".
            "‚Ä¢ Windows/Mac: –°–∫–∞—á–∞–π—Ç–µ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ outline.org\n\n".

            "üîπ <b>–®–∞–≥ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞</b>\n".
            "‚Ä¢ –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Outline Client\n".
            "‚Ä¢ –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É \"+\" –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞\n".
            "‚Ä¢ –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∫–ª—é—á –≤—Ä—É—á–Ω—É—é\n".
            "‚Ä¢ –ù–∞–∂–º–∏—Ç–µ \"–î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä\"\n\n".

            "üîπ <b>–®–∞–≥ 3: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</b>\n".
            "‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä\n".
            "‚Ä¢ –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (‚ñ∂Ô∏è)\n".
            "‚Ä¢ –î–æ–∂–¥–∏—Ç–µ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n\n".

            "üí° <b>–°–æ–≤–µ—Ç—ã:</b>\n".
            "‚Ä¢ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é\n".
            "‚Ä¢ –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ\n".
            '‚Ä¢ –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∫–ª—é—á–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /key';
    }

    private function getOpenVPNInstructions(): string
    {
        return "üîí <b>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –∫ OpenVPN</b>\n\n".
            "üîπ <b>–®–∞–≥ 1: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</b>\n".
            "‚Ä¢ Android: –°–∫–∞—á–∞–π—Ç–µ OpenVPN Connect –∏–∑ Google Play\n".
            "‚Ä¢ iOS: –°–∫–∞—á–∞–π—Ç–µ OpenVPN Connect –∏–∑ App Store\n".
            "‚Ä¢ Windows/Mac: –°–∫–∞—á–∞–π—Ç–µ —Å openvpn.net\n\n".

            "üîπ <b>–®–∞–≥ 2: –ò–º–ø–æ—Ä—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</b>\n".
            "‚Ä¢ –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ OpenVPN Connect\n".
            "‚Ä¢ –ù–∞–∂–º–∏—Ç–µ \"–ò–º–ø–æ—Ä—Ç\" –∏–ª–∏ \"+\"\n".
            "‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ .ovpn —Ñ–∞–π–ª –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ URL\n".
            "‚Ä¢ –ù–∞–∂–º–∏—Ç–µ \"–ò–º–ø–æ—Ä—Ç\"\n\n".

            "üîπ <b>–®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</b>\n".
            "‚Ä¢ –í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –æ—Ç –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞\n".
            "‚Ä¢ –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n".
            "‚Ä¢ –ù–∞–∂–º–∏—Ç–µ \"–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è\"\n\n".

            "üîπ <b>–®–∞–≥ 4: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</b>\n".
            "‚Ä¢ –î–æ–∂–¥–∏—Ç–µ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ VPN —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n".
            "‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è\n\n".

            "üí° <b>–°–æ–≤–µ—Ç—ã:</b>\n".
            "‚Ä¢ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ .ovpn —Ñ–∞–π–ª –Ω–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω\n".
            "‚Ä¢ –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å\n".
            '‚Ä¢ –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /key';
    }

    private function getXrayInstructions(): string
    {
        return "‚ö° <b>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –∫ Xray (V2Ray)</b>\n\n".
            "üîπ <b>–®–∞–≥ 1: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</b>\n".
            "‚Ä¢ Android: –°–∫–∞—á–∞–π—Ç–µ V2RayNG –∏–∑ Google Play\n".
            "‚Ä¢ iOS: –°–∫–∞—á–∞–π—Ç–µ V2RayX –∏–∑ App Store\n".
            "‚Ä¢ Windows: –°–∫–∞—á–∞–π—Ç–µ V2RayN —Å GitHub\n".
            "‚Ä¢ Mac: –°–∫–∞—á–∞–π—Ç–µ V2RayX —Å GitHub\n\n".

            "üîπ <b>–®–∞–≥ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞</b>\n".
            "‚Ä¢ –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ V2RayNG/V2RayX\n".
            "‚Ä¢ –ù–∞–∂–º–∏—Ç–µ \"+\" –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞\n".
            "‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –∏–º–ø–æ—Ä—Ç–∞:\n".
            "  - QR-–∫–æ–¥\n".
            "  - –°—Å—ã–ª–∫–∞ (vmess://, vless://, trojan://)\n".
            "  - –†—É—á–Ω–æ–π –≤–≤–æ–¥\n\n".

            "üîπ <b>–®–∞–≥ 3: –í—ã–±–æ—Ä –ø—Ä–æ—Ç–æ–∫–æ–ª–∞</b>\n".
            "‚Ä¢ VMess: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª\n".
            "‚Ä¢ VLESS: –õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª\n".
            "‚Ä¢ Trojan: –ü—Ä–æ—Ç–æ–∫–æ–ª —Å TLS —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º\n".
            "‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π\n\n".

            "üîπ <b>–®–∞–≥ 4: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</b>\n".
            "‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä\n".
            "‚Ä¢ –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è\n".
            "‚Ä¢ –î–æ–∂–¥–∏—Ç–µ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n\n".

            "üí° <b>–°–æ–≤–µ—Ç—ã:</b>\n".
            "‚Ä¢ VMess —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤\n".
            "‚Ä¢ VLESS –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –º–µ–Ω–µ–µ —Å–æ–≤–º–µ—Å—Ç–∏–º\n".
            "‚Ä¢ Trojan –ª—É—á—à–µ –æ–±—Ö–æ–¥–∏—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏\n".
            '‚Ä¢ –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /key';
    }

    private function getMainInstructions(): string
    {
        return "üîß <b>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –∫ VPN</b>\n\n".
            "–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π:\n\n".
            "üì± <b>Outline (Shadowsocks)</b>\n".
            "‚Ä¢ –°–∫–∞—á–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Outline Client\n".
            "‚Ä¢ –î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á —á–µ—Ä–µ–∑ QR-–∫–æ–¥ –∏–ª–∏ –≤—Ä—É—á–Ω—É—é\n".
            "‚Ä¢ –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è\n\n".

            "üîí <b>OpenVPN</b>\n".
            "‚Ä¢ –°–∫–∞—á–∞–π—Ç–µ OpenVPN Connect\n".
            "‚Ä¢ –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ .ovpn —Ñ–∞–π–ª\n".
            "‚Ä¢ –í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å\n".
            "‚Ä¢ –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É\n\n".

            "‚ö° <b>Xray (V2Ray)</b>\n".
            "‚Ä¢ –°–∫–∞—á–∞–π—Ç–µ V2RayNG (Android) –∏–ª–∏ V2RayX (iOS)\n".
            "‚Ä¢ –î–æ–±–∞–≤—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å–µ—Ä–≤–µ—Ä–∞\n".
            "‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ç–æ–∫–æ–ª (VMess, VLESS, Trojan)\n".
            "‚Ä¢ –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è\n\n".

            "üí° <b>–ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã:</b>\n".
            "‚Ä¢ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ\n".
            "‚Ä¢ –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä\n".
            "‚Ä¢ –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–ª—é—á–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /key\n".
            "‚Ä¢ –î–ª—è –æ–ø–ª–∞—Ç—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /pay\n\n".

            '‚ùì –ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É.';
    }
}
